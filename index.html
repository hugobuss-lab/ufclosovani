<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Losování zápasníků</title>

    <!-- Google Fonts: UFC styl -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css">

    <!-- Font Awesome (ikony) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Animate.css (animace) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Oswald', sans-serif; /* Nastavení UFC stylu */
        }
        .container {
            max-width: 700px;
        }
        .card {
            transition: 0.3s;
            text-align: center;
        }
        .card:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="container mt-4">

    <h1 class="text-center fw-bold">
        Losování zápasníků <i class="fa-solid fa-users"></i>
    </h1>

    <div class="row justify-content-center my-4">
        <button id="drawFighterBtn" class="btn btn-primary mx-2 animate__animated animate__pulse">
            <i class="fa-solid fa-dice"></i> Losuj pro Uživatele 1
        </button>
        <button id="drawFighterBtn2" class="btn btn-primary mx-2 animate__animated animate__pulse">
            <i class="fa-solid fa-dice"></i> Losuj pro Uživatele 2
        </button>
        <button id="drawMatchupBtn" class="btn btn-success mx-2">
            <i class="fa-solid fa-handshake"></i> Vygeneruj zápasy
        </button>
    </div>

    <div class="row justify-content-center my-4">
        <button id="resetGameBtn" class="btn btn-danger">
            <i class="fa-solid fa-trash"></i> Resetovat hru
        </button>
    </div>

    <!-- Výpis zápasníků -->
    <h2 class="text-primary">Uživatel 1</h2>
    <div id="fighters1" class="row row-cols-2 g-2"></div>

    <h2 class="text-success mt-4">Uživatel 2</h2>
    <div id="fighters2" class="row row-cols-2 g-2"></div>

    <h2 class="text-warning mt-4">Vygenerované zápasy</h2>
    <pre id="matchup" class="p-3 bg-dark text-white rounded"></pre>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBchdjFEa0njLG5xpXWhPMJqq4O34gysNg",
            authDomain: "ufclosovani.firebaseapp.com",
            projectId: "ufclosovani",
            storageBucket: "ufclosovani.firebasestorage.app",
            messagingSenderId: "138751202363",
            appId: "1:138751202363:web:71fcefa92e79a90c9fb81e",
            measurementId: "G-Q4MZ39CYVD"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const allFighters = [
            'Omari Akhmedov', 'Michael Bisping', 'Derek Brunson', 'Jared Canonnier', 'Khamzat Chimaev',
            'Paulo Costa', 'Nick Diaz', 'Dricus Du Plessis', 'Kelvin Gastelum', 'Uriah Hall',
            'Jack Hermansson', 'Kevin Holland', 'Krzysztof Jotko', 'Lyoto Machida', 'Demian Maia',
            'Bo Nickal', 'Alex Pereira', 'Luke Rockhold', 'Yoel Romero', 'Thiago Santos',
            'Anderson Silva', 'Anthony Smith', 'G. St-Pierre', 'Sean Strickland', 'Darren Till',
            'Marvin Vettori', 'Robert Whittaker'
        ];

        let availableFighters = [...allFighters];
        let user1Fighters = [];
        let user2Fighters = [];

        // Funkce pro losování zápasníků pro uživatele
        async function drawFighters(role) {
            let selectedFighters = [];

            if (role === "user1") {
                // Losování pro uživatele 1
                for (let i = 0; i < 8; i++) {
                    const randomIndex = Math.floor(Math.random() * availableFighters.length);
                    selectedFighters.push(availableFighters[randomIndex]);
                    availableFighters.splice(randomIndex, 1);
                }
                user1Fighters = selectedFighters;
            } else if (role === "user2") {
                // Losování pro uživatele 2 (nebudou se opakovat zápasníci)
                for (let i = 0; i < 8; i++) {
                    const randomIndex = Math.floor(Math.random() * availableFighters.length);
                    selectedFighters.push(availableFighters[randomIndex]);
                    availableFighters.splice(randomIndex, 1);
                }
                user2Fighters = selectedFighters;
            }

            await setDoc(doc(db, "game", role), { fighters: selectedFighters });
        }

        // Funkce pro generování zápasů
        async function drawMatchups() {
            if (user1Fighters.length === 8 && user2Fighters.length === 8) {
                const matchups = user1Fighters.map((fighter, index) => `${fighter} vs. ${user2Fighters[index]}`);
                await setDoc(doc(db, "game", "matchups"), { matches: matchups });
            }
        }

        // Funkce pro resetování hry
        async function resetGame() {
            availableFighters = [...allFighters];
            user1Fighters = [];
            user2Fighters = [];
            await deleteDoc(doc(db, "game", "user1"));
            await deleteDoc(doc(db, "game", "user2"));
            await deleteDoc(doc(db, "game", "matchups"));
            location.reload();
        }

        // Sledování změn v databázi a aktualizace na stránce
        onSnapshot(doc(db, "game", "user1"), (doc) => {
            if (doc.exists()) {
                document.getElementById('fighters1').innerHTML = doc.data().fighters.map(fighter =>
                    `<div class="col"><div class="card p-2">${fighter}</div></div>`
                ).join('');
            }
        });

        onSnapshot(doc(db, "game", "user2"), (doc) => {
            if (doc.exists()) {
                document.getElementById('fighters2').innerHTML = doc.data().fighters.map(fighter =>
                    `<div class="col"><div class="card p-2">${fighter}</div></div>`
                ).join('');
            }
        });

        onSnapshot(doc(db, "game", "matchups"), (doc) => {
            if (doc.exists()) {
                document.getElementById('matchup').innerText = doc.data().matches.join('\n');
            }
        });

        // Event Listeners pro tlačítka
        document.getElementById('drawFighterBtn').addEventListener('click', () => drawFighters("user1"));
        document.getElementById('drawFighterBtn2').addEventListener('click', () => drawFighters("user2"));
        document.getElementById('drawMatchupBtn').addEventListener('click', drawMatchups);
        document.getElementById('resetGameBtn').addEventListener('click', resetGame);
    </script>

</body>
</html>
